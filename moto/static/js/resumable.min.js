!function(){"use strict";var e=function(t){function n(e,t){var n=this;n.opts={},n.getOpt=e.getOpt,n._prevProgress=0,n.resumableObj=e,n.file=t,n.fileName=t.fileName||t.name,n.size=t.size,n.relativePath=t.webkitRelativePath||t.relativePath||n.fileName,n.uniqueIdentifier=s.generateUniqueIdentifier(t),n._pause=!1,n.container="";var r=!1,a=function(e,t){switch(e){case"progress":n.resumableObj.fire("fileProgress",n);break;case"error":n.abort(),r=!0,n.chunks=[],n.resumableObj.fire("fileError",n,t);break;case"success":if(r)return;n.resumableObj.fire("fileProgress",n),n.isComplete()&&n.resumableObj.fire("fileSuccess",n,t);break;case"retry":n.resumableObj.fire("fileRetry",n)}};return n.chunks=[],n.abort=function(){var e=0;s.each(n.chunks,function(t){"uploading"==t.status()&&(t.abort(),e++)}),e>0&&n.resumableObj.fire("fileProgress",n)},n.cancel=function(){var e=n.chunks;n.chunks=[],s.each(e,function(e){"uploading"==e.status()&&(e.abort(),n.resumableObj.uploadNextChunk())}),n.resumableObj.removeFile(n),n.resumableObj.fire("fileProgress",n)},n.retry=function(){n.bootstrap();var e=!1;n.resumableObj.on("chunkingComplete",function(){e||n.resumableObj.upload(),e=!0})},n.bootstrap=function(){n.abort(),r=!1,n.chunks=[],n._prevProgress=0;for(var e=n.getOpt("forceChunkSize")?Math.ceil:Math.floor,t=Math.max(e(n.file.size/n.getOpt("chunkSize")),1),s=0;t>s;s++)!function(e){window.setTimeout(function(){n.chunks.push(new i(n.resumableObj,n,e,a)),n.resumableObj.fire("chunkingProgress",n,e/t)},0)}(s);window.setTimeout(function(){n.resumableObj.fire("chunkingComplete",n)},0)},n.progress=function(){if(r)return 1;var e=0,t=!1;return s.each(n.chunks,function(n){"error"==n.status()&&(t=!0),e+=n.progress(!0)}),e=t?1:e>.99999?1:e,e=Math.max(n._prevProgress,e),n._prevProgress=e,e},n.isUploading=function(){var e=!1;return s.each(n.chunks,function(t){return"uploading"==t.status()?(e=!0,!1):void 0}),e},n.isComplete=function(){var e=!1;return s.each(n.chunks,function(t){var n=t.status();return"pending"==n||"uploading"==n||1===t.preprocessState?(e=!0,!1):void 0}),!e},n.pause=function(e){"undefined"==typeof e?n._pause=n._pause?!1:!0:n._pause=e},n.isPaused=function(){return n._pause},n.resumableObj.fire("chunkingStart",n),n.bootstrap(),this}function i(e,t,n,i){var r=this;r.opts={},r.getOpt=e.getOpt,r.resumableObj=e,r.fileObj=t,r.fileObjSize=t.size,r.fileObjType=t.file.type,r.offset=n,r.callback=i,r.lastProgressCallback=new Date,r.tested=!1,r.retries=0,r.pendingRetry=!1,r.preprocessState=0;var a=r.getOpt("chunkSize");return r.loaded=0,r.startByte=r.offset*a,r.endByte=Math.min(r.fileObjSize,(r.offset+1)*a),r.fileObjSize-r.endByte<a&&!r.getOpt("forceChunkSize")&&(r.endByte=r.fileObjSize),r.xhr=null,r.test=function(){r.xhr=new XMLHttpRequest;var e=function(e){r.tested=!0;var t=r.status();"success"==t?(r.callback(t,r.message()),r.resumableObj.uploadNextChunk()):r.send()};r.xhr.addEventListener("load",e,!1),r.xhr.addEventListener("error",e,!1),r.xhr.addEventListener("timeout",e,!1);var t=[],n=r.getOpt("query");"function"==typeof n&&(n=n(r.fileObj,r)),s.each(n,function(e,n){t.push([encodeURIComponent(e),encodeURIComponent(n)].join("="))}),t.push(["resumableChunkNumber",encodeURIComponent(r.offset+1)].join("=")),t.push(["resumableChunkSize",encodeURIComponent(r.getOpt("chunkSize"))].join("=")),t.push(["resumableCurrentChunkSize",encodeURIComponent(r.endByte-r.startByte)].join("=")),t.push(["resumableTotalSize",encodeURIComponent(r.fileObjSize)].join("=")),t.push(["resumableType",encodeURIComponent(r.fileObjType)].join("=")),t.push(["resumableIdentifier",encodeURIComponent(r.fileObj.uniqueIdentifier)].join("=")),t.push(["resumableFilename",encodeURIComponent(r.fileObj.fileName)].join("=")),t.push(["resumableRelativePath",encodeURIComponent(r.fileObj.relativePath)].join("=")),t.push(["resumableTotalChunks",encodeURIComponent(r.fileObj.chunks.length)].join("=")),r.xhr.open("GET",s.getTarget(t)),r.xhr.timeout=r.getOpt("xhrTimeout"),r.xhr.withCredentials=r.getOpt("withCredentials"),s.each(r.getOpt("headers"),function(e,t){r.xhr.setRequestHeader(e,t)}),r.xhr.send(null)},r.preprocessFinished=function(){r.preprocessState=2,r.send()},r.send=function(){var e=r.getOpt("preprocess");if("function"==typeof e)switch(r.preprocessState){case 0:return e(r),void(r.preprocessState=1);case 1:return;case 2:}if(r.getOpt("testChunks")&&!r.tested)return void r.test();r.xhr=new XMLHttpRequest,r.xhr.upload.addEventListener("progress",function(e){new Date-r.lastProgressCallback>1e3*r.getOpt("throttleProgressCallbacks")&&(r.callback("progress"),r.lastProgressCallback=new Date),r.loaded=e.loaded||0},!1),r.loaded=0,r.pendingRetry=!1,r.callback("progress");var t=function(e){var t=r.status();if("success"==t||"error"==t)r.callback(t,r.message()),r.resumableObj.uploadNextChunk();else{r.callback("retry",r.message()),r.abort(),r.retries++;var n=r.getOpt("chunkRetryInterval");void 0!==n?(r.pendingRetry=!0,setTimeout(r.send,n)):r.send()}};r.xhr.addEventListener("load",t,!1),r.xhr.addEventListener("error",t,!1),r.xhr.addEventListener("timeout",t,!1);var n={resumableChunkNumber:r.offset+1,resumableChunkSize:r.getOpt("chunkSize"),resumableCurrentChunkSize:r.endByte-r.startByte,resumableTotalSize:r.fileObjSize,resumableType:r.fileObjType,resumableIdentifier:r.fileObj.uniqueIdentifier,resumableFilename:r.fileObj.fileName,resumableRelativePath:r.fileObj.relativePath,resumableTotalChunks:r.fileObj.chunks.length},i=r.getOpt("query");"function"==typeof i&&(i=i(r.fileObj,r)),s.each(i,function(e,t){n[e]=t});var a=r.fileObj.file.slice?"slice":r.fileObj.file.mozSlice?"mozSlice":r.fileObj.file.webkitSlice?"webkitSlice":"slice",o=r.fileObj.file[a](r.startByte,r.endByte),l=null,u=r.getOpt("target");if("octet"===r.getOpt("method")){l=o;var f=[];s.each(n,function(e,t){f.push([encodeURIComponent(e),encodeURIComponent(t)].join("="))}),u=s.getTarget(f)}else l=new FormData,s.each(n,function(e,t){l.append(e,t)}),l.append(r.getOpt("fileParameterName"),o);r.xhr.open("POST",u),r.xhr.timeout=r.getOpt("xhrTimeout"),r.xhr.withCredentials=r.getOpt("withCredentials"),s.each(r.getOpt("headers"),function(e,t){r.xhr.setRequestHeader(e,t)}),r.xhr.send(l)},r.abort=function(){r.xhr&&r.xhr.abort(),r.xhr=null},r.status=function(){return r.pendingRetry?"uploading":r.xhr?r.xhr.readyState<4?"uploading":200==r.xhr.status?"success":s.contains(r.getOpt("permanentErrors"),r.xhr.status)||r.retries>=r.getOpt("maxChunkRetries")?"error":(r.abort(),"pending"):"pending"},r.message=function(){return r.xhr?r.xhr.responseText:""},r.progress=function(e){"undefined"==typeof e&&(e=!1);var t=e?(r.endByte-r.startByte)/r.fileObjSize:1;if(r.pendingRetry)return 0;var n=r.status();switch(n){case"success":case"error":return 1*t;case"pending":return 0*t;default:return r.loaded/(r.endByte-r.startByte)*t}},this}if(!(this instanceof e))return new e(t);if(this.version=1,this.support=!("undefined"==typeof File||"undefined"==typeof Blob||"undefined"==typeof FileList||!Blob.prototype.webkitSlice&&!Blob.prototype.mozSlice&&!Blob.prototype.slice),!this.support)return!1;var r=this;r.files=[],r.defaults={chunkSize:1048576,forceChunkSize:!1,simultaneousUploads:3,fileParameterName:"file",throttleProgressCallbacks:.5,query:{},headers:{},preprocess:null,method:"multipart",prioritizeFirstAndLastChunk:!1,target:"/",testChunks:!0,generateUniqueIdentifier:null,maxChunkRetries:void 0,chunkRetryInterval:void 0,permanentErrors:[400,404,415,500,501],maxFiles:void 0,withCredentials:!1,xhrTimeout:0,maxFilesErrorCallback:function(e,t){var n=r.getOpt("maxFiles");alert("Please upload "+n+" file"+(1===n?"":"s")+" at a time.")},minFileSize:1,minFileSizeErrorCallback:function(e,t){alert(e.fileName||e.name+" is too small, please upload files larger than "+s.formatSize(r.getOpt("minFileSize"))+".")},maxFileSize:void 0,maxFileSizeErrorCallback:function(e,t){alert(e.fileName||e.name+" is too large, please upload files less than "+s.formatSize(r.getOpt("maxFileSize"))+".")},fileType:[],fileTypeErrorCallback:function(e,t){alert(e.fileName||e.name+" has type not allowed, please upload files of type "+r.getOpt("fileType")+".")}},r.opts=t||{},r.getOpt=function(t){var r=this;if(t instanceof Array){var a={};return s.each(t,function(e){a[e]=r.getOpt(e)}),a}if(r instanceof i){if("undefined"!=typeof r.opts[t])return r.opts[t];r=r.fileObj}if(r instanceof n){if("undefined"!=typeof r.opts[t])return r.opts[t];r=r.resumableObj}return r instanceof e?"undefined"!=typeof r.opts[t]?r.opts[t]:r.defaults[t]:void 0},r.events=[],r.on=function(e,t){r.events.push(e.toLowerCase(),t)},r.fire=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);for(var n=e[0].toLowerCase(),t=0;t<=r.events.length;t+=2)r.events[t]==n&&r.events[t+1].apply(r,e.slice(1)),"catchall"==r.events[t]&&r.events[t+1].apply(null,e);"fileerror"==n&&r.fire("error",e[2],e[1]),"fileprogress"==n&&r.fire("progress")};var s={stopEvent:function(e){e.stopPropagation(),e.preventDefault()},each:function(e,t){if("undefined"!=typeof e.length){for(var n=0;n<e.length;n++)if(t(e[n])===!1)return}else for(n in e)if(t(n,e[n])===!1)return},generateUniqueIdentifier:function(e){var t=r.getOpt("generateUniqueIdentifier");if("function"==typeof t)return t(e);var n=e.webkitRelativePath||e.fileName||e.name,i=e.size;return i+"-"+n.replace(/[^0-9a-zA-Z_-]/gim,"")},contains:function(e,t){var n=!1;return s.each(e,function(e){return e==t?(n=!0,!1):!0}),n},formatSize:function(e){return 1024>e?e+" bytes":1048576>e?(e/1024).toFixed(0)+" KB":1073741824>e?(e/1024/1024).toFixed(1)+" MB":(e/1024/1024/1024).toFixed(1)+" GB"},getTarget:function(e){var t=r.getOpt("target");return t+=t.indexOf("?")<0?"?":"&",t+e.join("&")}},a=function(e){s.stopEvent(e),e.dataTransfer&&e.dataTransfer.items?l(e.dataTransfer.items,e):e.dataTransfer&&e.dataTransfer.files&&l(e.dataTransfer.files,e)},o=function(e){e.preventDefault()},l=function(e,t,n,i){n||(n={total:0,files:[],event:t}),u(e.length,n);for(var r=0;r<e.length;r++){var s,a,o=e[r];if(o.isFile||o.isDirectory)s=o;else if(o.getAsEntry)s=o.getAsEntry();else{if(!o.webkitGetAsEntry){if("function"==typeof o.getAsFile){f(o.getAsFile(),n,i);continue}if(File&&o instanceof File){f(o,n,i);continue}u(-1,n);continue}s=o.webkitGetAsEntry()}if(s){if(s.isFile)s.file(function(e){f(e,n,i)},function(e){console.warn(e)});else if(s.isDirectory){a=s.createReader();var c=function(e){return function(i){l(i,t,n,e),u(-1,n)}};a.readEntries(c(s.fullPath),function(e){console.warn(e)})}}else u(-1,n)}},u=function(e,t){t.total+=e,t.files.length===t.total&&c(t.files,t.event)},f=function(e,t,n){n&&(e.relativePath=n+"/"+e.name),t.files.push(e),t.files.length===t.total&&c(t.files,t.event)},c=function(e,t){var i=0,a=r.getOpt(["maxFiles","minFileSize","maxFileSize","maxFilesErrorCallback","minFileSizeErrorCallback","maxFileSizeErrorCallback","fileType","fileTypeErrorCallback"]);if("undefined"!=typeof a.maxFiles&&a.maxFiles<e.length+r.files.length){if(1!==a.maxFiles||1!==r.files.length||1!==e.length)return a.maxFilesErrorCallback(e,i++),!1;r.removeFile(r.files[0])}var o=[];s.each(e,function(e){var l=e.name.split("."),u=l[l.length-1].toLowerCase();return a.fileType.length>0&&!s.contains(a.fileType,u)?(a.fileTypeErrorCallback(e,i++),!1):"undefined"!=typeof a.minFileSize&&e.size<a.minFileSize?(a.minFileSizeErrorCallback(e,i++),!1):"undefined"!=typeof a.maxFileSize&&e.size>a.maxFileSize?(a.maxFileSizeErrorCallback(e,i++),!1):void(r.getFromUniqueIdentifier(s.generateUniqueIdentifier(e))||!function(){var i=new n(r,e);window.setTimeout(function(){r.files.push(i),o.push(i),i.container="undefined"!=typeof t?t.srcElement:null,r.fire("fileAdded",i,t)},0)}())}),window.setTimeout(function(){r.fire("filesAdded",o)},0)};return r.uploadNextChunk=function(){var e=!1;if(r.getOpt("prioritizeFirstAndLastChunk")&&(s.each(r.files,function(t){return t.chunks.length&&"pending"==t.chunks[0].status()&&0===t.chunks[0].preprocessState?(t.chunks[0].send(),e=!0,!1):t.chunks.length>1&&"pending"==t.chunks[t.chunks.length-1].status()&&0===t.chunks[t.chunks.length-1].preprocessState?(t.chunks[t.chunks.length-1].send(),e=!0,!1):void 0}),e))return!0;if(s.each(r.files,function(t){return t.isPaused()===!1&&s.each(t.chunks,function(t){return"pending"==t.status()&&0===t.preprocessState?(t.send(),e=!0,!1):void 0}),e?!1:void 0}),e)return!0;var t=!1;return s.each(r.files,function(e){return e.isComplete()?void 0:(t=!0,!1)}),t||r.fire("complete"),!1},r.assignBrowse=function(e,t){"undefined"==typeof e.length&&(e=[e]),s.each(e,function(e){var n;"INPUT"===e.tagName&&"file"===e.type?n=e:(n=document.createElement("input"),n.setAttribute("type","file"),n.style.display="none",e.addEventListener("click",function(){n.style.opacity=0,n.style.display="block",n.focus(),n.click(),n.style.display="none"},!1),e.appendChild(n));var i=r.getOpt("maxFiles");"undefined"==typeof i||1!=i?n.setAttribute("multiple","multiple"):n.removeAttribute("multiple"),t?n.setAttribute("webkitdirectory","webkitdirectory"):n.removeAttribute("webkitdirectory"),n.addEventListener("change",function(e){c(e.target.files,e),e.target.value=""},!1)})},r.assignDrop=function(e){"undefined"==typeof e.length&&(e=[e]),s.each(e,function(e){e.addEventListener("dragover",o,!1),e.addEventListener("drop",a,!1)})},r.unAssignDrop=function(e){"undefined"==typeof e.length&&(e=[e]),s.each(e,function(e){e.removeEventListener("dragover",o),e.removeEventListener("drop",a)})},r.isUploading=function(){var e=!1;return s.each(r.files,function(t){return t.isUploading()?(e=!0,!1):void 0}),e},r.upload=function(){if(!r.isUploading()){r.fire("uploadStart");for(var e=1;e<=r.getOpt("simultaneousUploads");e++)r.uploadNextChunk()}},r.pause=function(){s.each(r.files,function(e){e.abort()}),r.fire("pause")},r.cancel=function(){for(var e=r.files.length-1;e>=0;e--)r.files[e].cancel();r.fire("cancel")},r.progress=function(){var e=0,t=0;return s.each(r.files,function(n){e+=n.progress()*n.size,t+=n.size}),t>0?e/t:0},r.addFile=function(e,t){c([e],t)},r.removeFile=function(e){for(var t=r.files.length-1;t>=0;t--)r.files[t]===e&&r.files.splice(t,1)},r.getFromUniqueIdentifier=function(e){var t=!1;return s.each(r.files,function(n){n.uniqueIdentifier==e&&(t=n)}),t},r.getSize=function(){var e=0;return s.each(r.files,function(t){e+=t.size}),e},this};"undefined"!=typeof module?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):window.Resumable=e}();